{% load static %}
<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>{% if object %}编辑主机{% else %}添加主机{% endif %}</title>
  <link href="//unpkg.com/layui@2.11.4/dist/css/layui.css" rel="stylesheet">

    <script src="//unpkg.com/layui@2.11.4/dist/layui.js"></script>

</head>
<body>
<div class="layui-container" style="padding: 20px; max-width: 600px;">
    <h2 class="layui-header">{% if object %}编辑主机{% else %}添加主机{% endif %}</h2>

    <form class="layui-form layui-form-pane" method="post">
        {% csrf_token %}

        <div class="layui-form-item">
            <label class="layui-form-label">主机名</label>
            <div class="layui-input-block">
                <input type="text" name="hostname" lay-verify="required" placeholder="请输入主机名"
                       value="{{ object.hostname|default_if_none:'' }}" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">IP地址</label>
            <div class="layui-input-block">
                <input type="text" name="ip" lay-verify="required|ip" placeholder="请输入IP地址"
                       value="{{ object.ip|default_if_none:'' }}" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">端口</label>
            <div class="layui-input-block">
                <input type="number" name="port" lay-verify="required|number" placeholder="请输入端口号"
                       value="{{ object.port|default_if_none:'22' }}" min="1" max="65535" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">用户名</label>
            <div class="layui-input-block">
                <input type="text" name="username" lay-verify="required" placeholder="请输入用户名"
                       value="{{ object.username|default_if_none:'' }}" class="layui-input">
            </div>
        </div>

        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="formDemo">保存</button>
{#                <a class="layui-btn layui-btn-primary" href="{% url 'host_manager:go_host_manager' %}">取消</a>#}
            </div>
        </div>
    </form>
</div>


<script>
layui.use(['form', 'jquery'], function(){
    var form = layui.form;
    var $ = layui.jquery;
       // 监听表单提交
    form.on('submit(formDemo)', function(data) {
        var index = parent.layer.getFrameIndex(window.name); // 先得到当前 iframe 层的索引
        parent.layer.close(index); // 再执行关闭

        // 如果你想继续提交表单（默认是原生提交），可以保留下面这行
        return true; // 允许表单原生提交
    });
    // 自定义 IP 校验规则（可选）
    form.verify({
        ip: function(value) {
            if (!/^(\d{1,3}\.){3}\d{1,3}$/.test(value)) {
                return '请输入正确的IP地址';
            }
        }
    });
});
</script>
</body>
</html>